$((function(){"use strict";let e="catalog-category-tabs-state",t="catalog-history";const a=(e,t,a)=>{const o=document.createElement(e);return t&&(o.className=t),a&&o.appendChild(document.createTextNode(a)),o};if(IssuesCatalogParam.selected_tags.length>0){const e=new Map;for(const t of IssuesCatalogParam.tags)e[t.id]=t;for(const t of IssuesCatalogParam.selected_tags)e[t.id]&&(e[t.id].select_count=t.select_count)}const o=new Map;for(const e of IssuesCatalogParam.tags)o[e.name]={allCount:e.count,selectCount:e.select_count,description:e.description,groups:e.groups};const s=()=>{const e=IssuesCatalogParam.select_filters.find((e=>"tags"==e[0]));return e&&e.length>=2?e[2]:[]},n=()=>{for(const e of document.querySelectorAll(".radio-select-mode"))if(e.checked)return e.value;return IssuesCatalogParam.select_mode},c=(e,t,s,n=!1)=>{const c=document.createElement("a");if(c.href="#",n){const e=a("span","icon-only",IssuesCatalogParam.label_clear);e.classList.add("catalog-icon-clear-selected"),c.appendChild(e)}c.appendChild(document.createTextNode(e));const l=a("span","catalog-tag-label","");l.appendChild(c);const r=o[e];if(r){const e="and"===t?r.selectCount:r.allCount,o=a("span","tag-count",`(${e})`);if(o.dataset.allcount=r.allCount,o.dataset.selectedcount=r.selectCount,l.appendChild(o),0===e&&l.classList.add("catalog-count-zero"),r.description){const e=a("div","tag-tooltip","");e.appendChild(a("div","tag-description",r.description)),l.appendChild(e)}}if(n)return l;{const e=a(s,"tags","");return e.appendChild(l),e}},l=()=>{const t=$(".category-tab");t.on("click",(function(){$(".active-tab").removeClass("active-tab"),$(this).addClass("active-tab");const a=t.index(this);$(".category-content").removeClass("show-content").eq(a).addClass("show-content"),localStorage.setItem(e,$(this).attr("id"))}))},r=e=>{const a=localStorage.getItem(t),o=a?JSON.parse(a):[],s=o.indexOf(e);s>=0&&o.splice(s,1),o.unshift(e),o.length>20&&o.pop(),localStorage.setItem(t,JSON.stringify(o))};$("#catalog-btn-thumbnails").on("click",(function(){$(this).toggleClass("only-thumbnails"),$("table.catalog-issues td.id").toggle(),$("table.catalog-issues td.subject").toggle(),$("table.catalog-issues td.tags").toggle(),$(".pagination.top").toggle()})),(()=>{for(const e of document.querySelectorAll(".catalog-tag-label")){const t=e.querySelector("a")?.innerText;if(t){const s=o[t];if(s&&s.description){const t=a("div","tag-tooltip","");t.appendChild(a("div","tag-description",s.description)),e.appendChild(t)}}}})(),(()=>{const e=(e,o,s)=>{const n=a("input","radio-select-mode","");n.type="radio",n.name="select-mode",n.id=`radio-select-mode-${o}`,n.value=o,n.checked=t===o,e.appendChild(n);const c=a("label","label-select-mode",s);c.htmlFor=`radio-select-mode-${o}`,e.appendChild(c)},t=n(),l=document.querySelector("#catalog_tags_selected"),r=s();if(l&&r.length>0){const s=a("div","selected-tags",""),n=[];for(let e=0;e<r.length;++e){e>0&&s.appendChild(a("span","","and"===IssuesCatalogParam.select_mode?" and ":" or ")),s.appendChild(c(r[e],t,"span",!0));const l=o[r[e]];if(l&&l.groups&&l.groups.length>0)for(const e of l.groups)n.includes(e)||n.push(e)}s.appendChild(a("span",""," : "));const d=a("a","",IssuesCatalogParam.label_clear_select);d.href=`${document.location.protocol}//${document.location.host}${document.location.pathname}`;const i=document.createElement("span");i.appendChild(d),s.appendChild(i),l.appendChild(s);const p=a("div","catalog-select-mode-operation","");if(e(p,"one",IssuesCatalogParam.label_operator_one),e(p,"and",IssuesCatalogParam.label_operator_and),e(p,"or",IssuesCatalogParam.label_operator_or),l.appendChild(p),n.length>0){l.appendChild(a("hr","catalog-separator",""));const e=a("div","catalog-selected-tag-groups","");e.appendChild(a("div","catalog-lavel-selected-tag-group",IssuesCatalogParam.label_selected_tag_group));for(const o of IssuesCatalogParam.tag_groups)for(const s of n){if(s!=o.id)continue;const n=a("fieldset","catalog-tag-group",""),l=document.createElement("legend");l.appendChild(document.createTextNode(o.name)),n.appendChild(l),n.appendChild(a("div","",o.description));for(const e of IssuesCatalogParam.tags)e.groups.includes(s)&&n.appendChild(c(e.name,t,"span"));e.appendChild(n)}l.appendChild(e)}}const d=document.querySelector("div.catalog-always-selector");if(d)for(const e of IssuesCatalogParam.tags)e.categories.includes(IssuesCatalogParam.tag_categories[0].id)&&d.appendChild(c(e.name,t,"span"))})(),(()=>{const e=IssuesCatalogParam.tag_categories.length,t=n(),o=document.querySelector("ul.tabs-area");if(o)if(1===e){const e=a("li","category-tab",IssuesCatalogParam.label_tag_category_none);e.id="category-tab-none",e.classList.add("active-tab"),o.prepend(e)}else for(let t=e-1;t>0;--t){const e=a("li","category-tab",IssuesCatalogParam.tag_categories[t].name);e.id="category-tab-id"+(t-1),1===t&&e.classList.add("active-tab"),o.prepend(e)}const s=document.querySelector("div.contents-area");if(s)if(1===e){const e=a("ul","tags","");for(const a of IssuesCatalogParam.tags)e.appendChild(c(a.name,t,"ul"));const o=a("div","category-content","");o.appendChild(e),1===i&&o.classList.add("show-content"),s.prepend(o)}else for(let o=e-1;o>0;--o){const e=a("ul","category-tags",""),n=IssuesCatalogParam.tag_categories[o].id;for(const a of IssuesCatalogParam.tags)a.categories.includes(n)&&e.appendChild(c(a.name,t,"ul"));const l=a("div","category-content","");l.appendChild(a("p","",IssuesCatalogParam.tag_categories[o].description)),l.appendChild(e),1===o&&l.classList.add("show-content"),s.prepend(l)}if(e>1){const e=document.querySelector("div.catalog-selector");if(e){e.appendChild(a("hr","catalog-separator",""));const o=a("div","other-tags","");for(const e of IssuesCatalogParam.tags)0==e.categories.length&&o.appendChild(c(e.name,t,"span"));e.appendChild(o)}}})(),(()=>{if(!(e=>{let t;try{t=window.localStorage;const e="__storage_test__";return t.setItem(e,e),t.removeItem(e),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}})())return;const a=$("body").attr("class");if(a)try{const o="-"+a.split(/\s+/).filter((function(e){return e.match(/project-.*/)})).sort().join("-");e+=o,t+=o}catch(e){}(()=>{const t=localStorage.getItem(e);if(!t)return;const a=$("#"+t);if(!a.length)return;$(".active-tab").removeClass("active-tab"),a.addClass("active-tab");const o=$(".category-tab").index(a);$(".category-content").removeClass("show-content").eq(o).addClass("show-content")})(),(()=>{const e=document.querySelector("#catalog-category-history");if(!e)return;const a=n(),o=localStorage.getItem(t),s=o?JSON.parse(o):[];for(const t of s)e.appendChild(c(t,a,"ul"))})(),l()})(),(()=>{const e=(e,t)=>{const a=document.createElement("input");return a.type="hidden",a.name=e,a.value=t,a};let t="";const a=$("body").attr("class").match(/project-([\w-]+)/);a&&(t=a[1]);const o=$("#catalog-input-search-tag");o.blur(),o.autocomplete({source:function(e,a){$.ajax({url:"/issue_tags/auto_complete/"+t,type:"GET",dataType:"json",data:{q:e.term},success:function(e){a(e)},error:function(e,t,o){a([""])}})},select:function(t,a){if(a.item&&a.item.value){const t=a.item.value,o=n(),c=s();c.includes(t)||c.push(t),r(t);const l=document.querySelector("#form-search-tag");if(l){switch(l.appendChild(e("sm",o)),l.appendChild(e("f[]","tags")),o){default:case"one":l.appendChild(e("op[tags]","=")),l.appendChild(e("v[tags][]",t));break;case"and":l.appendChild(e("op[tags]","and")),c.forEach((t=>l.appendChild(e("v[tags][]",t))));break;case"or":l.appendChild(e("op[tags]","=")),c.forEach((t=>l.appendChild(e("v[tags][]",t))))}l.submit()}}},minLength:1})})(),(()=>{const e=document.querySelector("#btn-scroll-to-top");e&&(e.addEventListener("click",(function(){window.scroll({top:0,behavior:"smooth"})})),window.addEventListener("scroll",(function(){window.pageYOffset>300?e.style.opacity="1":window.pageYOffset<300&&(e.style.opacity="0")})))})(),(()=>{const e=e=>{const t=[["set_filter","1"],["sort","priority:desc"],["sm",e],["f[]","tags"]];return IssuesCatalogParam.issues_open_only&&(t.push(["f[]","status_id"]),t.push(["op[status_id]","o"]),t.push(["v[status_id][]",""])),t};for(const e of document.querySelectorAll(".radio-select-mode"))e.addEventListener("click",(function(e){const t=this.value;for(const e of document.querySelectorAll(".catalog-tag-label .tag-count")){const a="and"===t?e.dataset.selectedcount:e.dataset.allcount;e.innerText=`(${a})`,"0"===a?e.parentElement.classList.add("catalog-count-zero"):e.parentElement.classList.remove("catalog-count-zero")}for(const e of document.querySelectorAll(".pagination a")){const a=(e.search?e.search.slice(1).split("&"):[]).map((e=>{const[a,o]=e.split("="),s=decodeURIComponent(a);let n=decodeURIComponent(o);return"sm"===s?n=t:"op[tags]"===s&&(n="and"===t?"and":"="),[s,n]}));e.search="?"+a.map((e=>`${encodeURIComponent(e[0])}=${encodeURIComponent(e[1])}`)).join("&")}}));for(const t of document.querySelectorAll(".tags a"))t.addEventListener("click",(function(t){const a=n(),o=this.innerText,c=e(a),l=s();switch(l.includes(o)||l.push(o),r(o),a){default:case"one":c.push(["op[tags]","="]),c.push(["v[tags][]",o]);break;case"and":c.push(["op[tags]","and"]),l.forEach((e=>c.push(["v[tags][]",e])));break;case"or":c.push(["op[tags]","="]),l.forEach((e=>c.push(["v[tags][]",e])))}this.search="?"+c.map((e=>`${encodeURIComponent(e[0])}=${encodeURIComponent(e[1])}`)).join("&")}));for(const t of document.querySelectorAll(".selected-tags .catalog-tag-label a"))t.addEventListener("click",(function(t){const a=n();let o=this.innerText;o.startsWith(IssuesCatalogParam.label_clear)&&(o=o.slice(IssuesCatalogParam.label_clear.length));const c=s().filter((e=>e!==o));if(0===c.length)this.search="",this.href.endsWith("#")&&(this.href=this.href.slice(0,-1));else{const t=e(a);t.push(["op[tags]","and"===a?"and":"="]),c.forEach((e=>t.push(["v[tags][]",e]))),this.search="?"+t.map((e=>`${encodeURIComponent(e[0])}=${encodeURIComponent(e[1])}`)).join("&")}}))})();const d=document.querySelector("#quick-search form");d&&(d.style.display="none")}));